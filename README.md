# HR Agent

A production-ready HR assistant demonstrating best practices in LLM-based agent design. Built with Python, SQLAlchemy, FastAPI, and Streamlit.

## Table of Contents

- [Overview](#overview)
- [Quick Start](#quick-start)
- [Web UI](#web-ui)
- [Architecture](#architecture)
- [Database Schema](#database-schema)
- [Sample Data](#sample-data)
- [Agent Design](#agent-design)
- [Policy Engine](#policy-engine)
- [Available Tools](#available-tools)
- [Access Control](#access-control)
- [Getting Started](#getting-started)
- [API Reference](#api-reference)
- [Evaluation Framework](#evaluation-framework)
- [Project Structure](#project-structure)
- [Configuration](#configuration)

---

## Overview

This HR Agent provides an intelligent interface for employees to interact with HR systems through natural language. It handles employee lookups, organizational navigation, time-off management, compensation queries, and company information retrieval.

```
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                         ğŸ’¬ HOW IT WORKS                                     â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

  ğŸ‘¤ User                    ğŸ¤– Agent                      ğŸ—„ï¸ Database
     â”‚                          â”‚                              â”‚
     â”‚  "What's my PTO         â”‚                              â”‚
     â”‚   balance?"             â”‚                              â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                              â”‚
     â”‚                          â”‚  1. Parse intent             â”‚
     â”‚                          â”‚  2. Check policies  ğŸ”       â”‚
     â”‚                          â”‚  3. Select tool              â”‚
     â”‚                          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                          â”‚                              â”‚
     â”‚                          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                          â”‚  4. Format response          â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
     â”‚  "You have 20 days      â”‚                              â”‚
     â”‚   remaining..."          â”‚                              â”‚
```

### Key Capabilities

| Capability | Description |
|------------|-------------|
| Policy-as-Code Authorization | Declarative YAML-based rules engine for access control |
| Human-in-the-Loop Confirmation | Sensitive actions require explicit user confirmation |
| Conversation Memory | Multi-turn context awareness across interactions |
| Response Summarization | Automatic pagination and token management |
| API-Ready Design | REST endpoints for web, mobile, and chat integrations |
| Evaluation Framework | Built-in testing harness with metrics collection |
| **Interactive Web UI** | Streamlit-based chat interface for easy testing |
| **Rich Demo Data** | 62 employees across 8 departments and 3 locations |

---

## Quick Start

```bash
# Clone and setup
git clone <repository-url>
cd hr-agent
python -m venv .venv
source .venv/bin/activate  # On Windows: .venv\Scripts\activate
pip install -r requirements.txt

# Set your OpenAI API key
cp .env.example .env
# Edit .env and add your OPENAI_API_KEY

# Run the Web UI (recommended for testing)
streamlit run app.py

# Or use the CLI
PYTHONPATH=./src python -m hr_agent.api.cli "What is my holiday balance?"

# Or start the API server
PYTHONPATH=./src python -m hr_agent.api.server
```

---

## Web UI

The HR Agent includes a modern Streamlit-based chat interface for easy testing and demonstration.

### Features

```
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                         ğŸ–¥ï¸ HR AGENT WEB UI                                  â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   ğŸ“‹ SIDEBAR        â”‚    â”‚              ğŸ’¬ CHAT AREA                    â”‚
  â”‚                     â”‚    â”‚                                              â”‚
  â”‚  ğŸ‘¤ User Selector   â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”‚ ğŸ‘¤ What is my holiday balance?       â”‚   â”‚
  â”‚  â”‚ Alex Kim â–¼    â”‚  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚                                              â”‚
  â”‚                     â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  ğŸ“§ alex.kim@...    â”‚    â”‚  â”‚ ğŸ¤– Your holiday balance for 2026:    â”‚   â”‚
  â”‚                     â”‚    â”‚  â”‚    â€¢ Entitled: 28 days               â”‚   â”‚
  â”‚  ğŸ“‹ Employee Info   â”‚    â”‚  â”‚    â€¢ Carried over: 2 days            â”‚   â”‚
  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    â”‚  â”‚    â€¢ Remaining: 25 days              â”‚   â”‚
  â”‚  Title: Software    â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚  Dept: Engineering  â”‚    â”‚                                              â”‚
  â”‚  Manager: Sam N.    â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚                     â”‚    â”‚  â”‚ ğŸ’¬ Ask me anything about HR...       â”‚   â”‚
  â”‚  âš¡ Quick Questions â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚                                              â”‚
  â”‚  â”‚ Holiday bal?  â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚  â”‚ Who's my mgr? â”‚  â”‚
  â”‚  â”‚ My salary?    â”‚  â”‚
  â”‚  â”‚ Salary hist?  â”‚  â”‚
  â”‚  â”‚ ...           â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                     â”‚
  â”‚  ğŸ—‘ï¸ Clear Chat     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Running the Web UI

```bash
# Start the Streamlit app
streamlit run app.py

# The UI will open at http://localhost:8501
```

### UI Capabilities

| Feature | Description |
|---------|-------------|
| **Employee Selector** | Switch between any of the 62 employees to test different perspectives |
| **Employee Info Card** | Shows current user's details (name, title, department, manager) |
| **Quick Questions** | 10 pre-built questions for instant testing |
| **Chat History** | Full conversation context maintained |
| **Clear Chat** | Reset conversation and start fresh |

---

## Architecture

The system follows a layered architecture with clear separation of concerns:

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           ğŸŒ CLIENT LAYER                                     â•‘
â•‘  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®          â•‘
â•‘  â”‚ ğŸ–¥ï¸  Web App â”‚  â”‚ ğŸ’¬  Slack  â”‚  â”‚ ğŸ“± Teams   â”‚  â”‚ âŒ¨ï¸  CLI     â”‚          â•‘
â•‘  â•°â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â•¯  â•°â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â•¯  â•°â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â•¯  â•°â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â•¯          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          â”‚                â”‚                â”‚                â”‚
          â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
                                   â”‚ HTTP/REST
                                   â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           ğŸš€ API LAYER (FastAPI)                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â•‘
â•‘  â”‚  Endpoints:                                                              â”‚â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚â•‘
â•‘  â”‚  â”‚ POST /chat     â”‚ â”‚ GET /session   â”‚ â”‚ GET /health    â”‚               â”‚â•‘
â•‘  â”‚  â”‚ Send message   â”‚ â”‚ Session info   â”‚ â”‚ Health check   â”‚               â”‚â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚â•‘
â•‘  â”‚  â”‚ DELETE /sessionâ”‚ â”‚ GET /me        â”‚   Auth: X-User-Email Header      â”‚â•‘
â•‘  â”‚  â”‚ End session    â”‚ â”‚ User context   â”‚                                  â”‚â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                                      â”‚
                                                      â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           ğŸ§  CORE LAYER                                       â•‘
â•‘                                                                               â•‘
â•‘   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                 â•‘
â•‘   â”‚       ğŸ¤– HRAgent         â”‚  â”‚    ğŸ” Policy Engine      â”‚                 â•‘
â•‘   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                 â•‘
â•‘   â”‚  â”‚ â€¢ Tool Executor    â”‚  â”‚  â”‚  â”‚ â€¢ YAML Rule Parser â”‚  â”‚                 â•‘
â•‘   â”‚  â”‚ â€¢ LLM Client       â”‚â—„â”€â”¼â”€â”€â”¼â”€â–ºâ”‚ â€¢ Condition Eval   â”‚  â”‚                 â•‘
â•‘   â”‚  â”‚ â€¢ Response Format  â”‚  â”‚  â”‚  â”‚ â€¢ Confirmation Mgr â”‚  â”‚                 â•‘
â•‘   â”‚  â”‚ â€¢ Multi-turn Loop  â”‚  â”‚  â”‚  â”‚ â€¢ Access Control   â”‚  â”‚                 â•‘
â•‘   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                 â•‘
â•‘   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯                 â•‘
â•‘                  â”‚                                                            â•‘
â•‘   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                                               â•‘
â•‘   â”‚     ğŸ’¾ Memory Store      â”‚  â† Conversation state & context               â•‘
â•‘   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                               â•‘
â•‘   â”‚  â”‚ â€¢ Sessions         â”‚  â”‚                                               â•‘
â•‘   â”‚  â”‚ â€¢ Turn History     â”‚  â”‚                                               â•‘
â•‘   â”‚  â”‚ â€¢ Pending Actions  â”‚  â”‚                                               â•‘
â•‘   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                               â•‘
â•‘   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                                      â”‚
                                                      â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           âš™ï¸ SERVICE LAYER (Business Logic)                   â•‘
â•‘                                                                               â•‘
â•‘   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®          â•‘
â•‘   â”‚  ğŸ‘¤ Employee Svc  â”‚ â”‚  ğŸ–ï¸ Holiday Svc   â”‚ â”‚  ğŸ’° Comp Svc      â”‚          â•‘
â•‘   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â•‘
â•‘   â”‚  â€¢ search()       â”‚ â”‚  â€¢ get_balance()  â”‚ â”‚  â€¢ get_salary()   â”‚          â•‘
â•‘   â”‚  â€¢ get_org_chart()â”‚ â”‚  â€¢ submit_request â”‚ â”‚  â€¢ get_history()  â”‚          â•‘
â•‘   â”‚  â€¢ get_directory()â”‚ â”‚  â€¢ approve/reject â”‚ â”‚  â€¢ get_summary()  â”‚          â•‘
â•‘   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯          â•‘
â•‘             â”‚                     â”‚                     â”‚                     â•‘
â•‘   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                                                      â•‘
â•‘   â”‚  ğŸ¢ Company Svc   â”‚   Validates business rules, enforces constraints     â•‘
â•‘   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                                      â•‘
â•‘   â”‚  â€¢ get_policies() â”‚                                                      â•‘
â•‘   â”‚  â€¢ get_holidays() â”‚                                                      â•‘
â•‘   â”‚  â€¢ get_events()   â”‚                                                      â•‘
â•‘   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯                                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              â”‚
              â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           ğŸ“¦ REPOSITORY LAYER (Data Access)                   â•‘
â•‘                                                                               â•‘
â•‘   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®       â•‘
â•‘   â”‚  EmployeeRepo      â”‚ â”‚  HolidayRepo       â”‚ â”‚  CompensationRepo  â”‚       â•‘
â•‘   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚       â•‘
â•‘   â”‚  SQLAlchemy ORM    â”‚ â”‚  SQLAlchemy ORM    â”‚ â”‚  SQLAlchemy ORM    â”‚       â•‘
â•‘   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯       â•‘
â•‘              â”‚                      â”‚                      â”‚                  â•‘
â•‘   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                                                     â•‘
â•‘   â”‚  CompanyRepo       â”‚   Abstracts SQL queries, provides clean interface   â•‘
â•‘   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯                                                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
               â”‚
               â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           ğŸ—„ï¸ DATABASE LAYER                                   â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â•‘
â•‘  â”‚                      SQLite / PostgreSQL                                 â”‚â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚â•‘
â•‘  â”‚  â”‚  employee   â”‚ â”‚   holiday   â”‚ â”‚compensation â”‚ â”‚   company   â”‚        â”‚â•‘
â•‘  â”‚  â”‚  identity   â”‚ â”‚   request   â”‚ â”‚   salary    â”‚ â”‚   policy    â”‚        â”‚â•‘
â•‘  â”‚  â”‚  app_role   â”‚ â”‚ entitlement â”‚ â”‚   history   â”‚ â”‚   events    â”‚        â”‚â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Layer Responsibilities

| Layer | Purpose | Key Components |
|-------|---------|----------------|
| API | HTTP endpoints and CLI interface | `server.py`, `cli.py` |
| Core | Agent orchestration, LLM interaction | `agent.py`, `memory.py`, `policy_engine.py` |
| Service | Business logic and validation | `EmployeeService`, `HolidayService`, etc. |
| Repository | Data access abstraction | `EmployeeRepository`, `HolidayRepository`, etc. |
| Infrastructure | Cross-cutting concerns | Config, logging, security, error handling |

---

## Database Schema

The system uses SQLite with the following schema:

### Entity Relationship Diagram

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           ğŸ‘¤ EMPLOYEE DOMAIN                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                               â•‘
â•‘  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®         â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®         â•‘
â•‘  â”‚       ğŸ”‘ employee         â”‚         â”‚      ğŸ”— identity_map      â”‚         â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â•‘
â•‘  â”‚ PK  employee_id      INT  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚ FK  employee_id      INT  â”‚         â•‘
â•‘  â”‚     legal_name       STR  â”‚         â”‚ PK  user_email       STR  â”‚â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚     preferred_name   STR  â”‚         â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯     â”‚   â•‘
â•‘  â”‚ UQ  email            STR  â”‚                                           â”‚   â•‘
â•‘  â”‚     title            STR  â”‚         â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®     â”‚   â•‘
â•‘  â”‚     department       STR  â”‚         â”‚      ğŸ­ app_role_map      â”‚     â”‚   â•‘
â•‘  â”‚     location         STR  â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚   â•‘
â•‘  â”‚     hire_date        DATE â”‚         â”‚ PK  user_email       STR  â”‚â—„â”€â”€â”€â”€â”˜   â•‘
â•‘  â”‚     employment_status STR â”‚         â”‚     app_role         ENUM â”‚         â•‘
â•‘  â”‚ FK  manager_employee_id   â”‚â”€â”€â”      â”‚     (EMPLOYEE|MANAGER|    â”‚         â•‘
â•‘  â”‚     cost_center      STR  â”‚  â”‚      â”‚      HR|FINANCE)          â”‚         â•‘
â•‘  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯  â”‚      â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯         â•‘
â•‘                  â”‚              â”‚                                             â•‘
â•‘         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                                             â•‘
â•‘         â”‚                       â–¼                                             â•‘
â•‘         â”‚       â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                                â•‘
â•‘         â”‚       â”‚    ğŸ“Š manager_reports     â”‚  Self-referencing for          â•‘
â•‘         â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  org hierarchy                 â•‘
â•‘         â”‚       â”‚ PK  manager_employee_id   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â•‘
â•‘         â”‚       â”‚ PK  report_employee_id    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â•‘
â•‘         â”‚       â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯                                â•‘
â•‘         â”‚                                                                     â•‘
â•‘         â”‚       â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                                â•‘
â•‘         â”‚       â”‚   ğŸ–ï¸ holiday_entitlement  â”‚                                â•‘
â•‘         â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                â•‘
â•‘         â””â”€â”€â”€â”€â”€â”€â–ºâ”‚ PK  employee_id      INT  â”‚                                â•‘
â•‘                 â”‚ PK  year             INT  â”‚                                â•‘
â•‘                 â”‚     entitlement_days INT  â”‚                                â•‘
â•‘                 â”‚     carried_over_days INT â”‚                                â•‘
â•‘                 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         ğŸ“‹ HOLIDAY & COMPENSATION                             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                               â•‘
â•‘  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®         â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®         â•‘
â•‘  â”‚    ğŸ“ holiday_request     â”‚         â”‚     ğŸ’° compensation       â”‚         â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â•‘
â•‘  â”‚ PK  request_id       INT  â”‚         â”‚ PK  employee_id      INT  â”‚â—„â”€â”€â”€â”    â•‘
â•‘  â”‚ FK  employee_id      INT  â”‚â”€â”€â”€â”€â”€â”   â”‚     currency         STR  â”‚    â”‚    â•‘
â•‘  â”‚     start_date       DATE â”‚     â”‚   â”‚     base_salary      DEC  â”‚    â”‚    â•‘
â•‘  â”‚     end_date         DATE â”‚     â”‚   â”‚     bonus_target_pct DEC  â”‚    â”‚    â•‘
â•‘  â”‚     days             INT  â”‚     â”‚   â”‚     equity_shares    INT  â”‚    â”‚    â•‘
â•‘  â”‚     status           ENUM â”‚     â”‚   â”‚     last_review_date DATE â”‚    â”‚    â•‘
â•‘  â”‚     (PENDING|APPROVED|    â”‚     â”‚   â”‚     next_review_date DATE â”‚    â”‚    â•‘
â•‘  â”‚      REJECTED|CANCELLED)  â”‚     â”‚   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯    â”‚    â•‘
â•‘  â”‚     reason           STR  â”‚     â”‚                                    â”‚    â•‘
â•‘  â”‚     requested_at     TS   â”‚     â”‚   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®    â”‚    â•‘
â•‘  â”‚ FK  reviewed_by      INT  â”‚     â”‚   â”‚     ğŸ“ˆ salary_history     â”‚    â”‚    â•‘
â•‘  â”‚     reviewed_at      TS   â”‚     â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚    â•‘
â•‘  â”‚     rejection_reason STR  â”‚     â”‚   â”‚ PK  id              INT   â”‚    â”‚    â•‘
â•‘  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯     â”‚   â”‚ FK  employee_id      INT  â”‚â”€â”€â”€â”€â”˜    â•‘
â•‘                                    â”‚   â”‚     effective_date   DATE â”‚         â•‘
â•‘                                    â”‚   â”‚     base_salary      DEC  â”‚         â•‘
â•‘                                    â”‚   â”‚     currency         STR  â”‚         â•‘
â•‘         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     change_reason    STR  â”‚         â•‘
â•‘         â”‚                              â”‚     change_pct       DEC  â”‚         â•‘
â•‘         â–¼                              â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯         â•‘
â•‘  Links to employee table                                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           ğŸ¢ COMPANY DOMAIN                                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                               â•‘
â•‘  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®               â•‘
â•‘  â”‚     ğŸ“œ company_policy     â”‚   â”‚    ğŸ“… company_holiday     â”‚               â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â•‘
â•‘  â”‚ PK  policy_id        INT  â”‚   â”‚ PK  id              INT   â”‚               â•‘
â•‘  â”‚     title            STR  â”‚   â”‚     holiday_date    DATE  â”‚               â•‘
â•‘  â”‚     category         STR  â”‚   â”‚     name            STR   â”‚               â•‘
â•‘  â”‚     summary          STR  â”‚   â”‚     is_paid         BOOL  â”‚               â•‘
â•‘  â”‚     full_text        TEXT â”‚   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯               â•‘
â•‘  â”‚     effective_date   DATE â”‚                                               â•‘
â•‘  â”‚     last_updated     DATE â”‚   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®               â•‘
â•‘  â”‚     status           STR  â”‚   â”‚     ğŸ‰ company_event      â”‚               â•‘
â•‘  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â•‘
â•‘                                  â”‚ PK  event_id        INT   â”‚               â•‘
â•‘  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®   â”‚     title            STR  â”‚               â•‘
â•‘  â”‚     ğŸ“¢ announcement       â”‚   â”‚     event_date       DATE â”‚               â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚     event_time       TIME â”‚               â•‘
â•‘  â”‚ PK  announcement_id  INT  â”‚   â”‚     location         STR  â”‚               â•‘
â•‘  â”‚     title            STR  â”‚   â”‚     description      TEXT â”‚               â•‘
â•‘  â”‚     summary          STR  â”‚   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯               â•‘
â•‘  â”‚     category         STR  â”‚                                               â•‘
â•‘  â”‚ FK  posted_by        INT  â”‚   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®               â•‘
â•‘  â”‚     posted_at        TS   â”‚   â”‚ ğŸ” finance_cost_center    â”‚               â•‘
â•‘  â”‚     expires_at       TS   â”‚   â”‚        _access            â”‚               â•‘
â•‘  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â•‘
â•‘                                  â”‚ PK  user_email       STR  â”‚               â•‘
â•‘                                  â”‚ PK  cost_center      STR  â”‚               â•‘
â•‘                                  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Key:  PK = Primary Key  â”‚  FK = Foreign Key  â”‚  UQ = Unique  â”‚  TS = Timestamp
```

---

## Sample Data

The database comes pre-seeded with comprehensive demo data for testing all features.

### Data Overview

| Table | Records | Description |
|-------|---------|-------------|
| `employee` | 62 | Employees across all departments and locations |
| `manager_reports` | 58 | Full organizational hierarchy |
| `identity_map` | 62 | Email to employee ID mappings |
| `app_role_map` | 62 | Role-based access control assignments |
| `holiday_entitlement` | 62 | 2026 holiday allowances for all employees |
| `holiday_request` | 30+ | Mix of approved, pending, and rejected requests |
| `compensation` | 62 | Current salary and bonus information |
| `salary_history` | 100+ | Historical salary changes with reasons |
| `company_policy` | 8 | HR policies (remote work, expenses, etc.) |
| `company_holiday` | 12 | 2026 public holidays |
| `company_event` | 10 | Upcoming company events |
| `announcement` | 5 | Company-wide announcements |

### Organizational Structure

```
Jordan Lee (CEO)
â”œâ”€â”€ Amanda Foster (CTO)
â”‚   â”œâ”€â”€ Sam Nguyen (Engineering Manager)
â”‚   â”‚   â”œâ”€â”€ Alex Kim, Jennifer Liu, Marcus Johnson...
â”‚   â”‚   â””â”€â”€ (6 engineers)
â”‚   â”œâ”€â”€ Olivia Wang (Frontend Lead)
â”‚   â”‚   â””â”€â”€ (4 frontend engineers)
â”‚   â”œâ”€â”€ Robert Taylor (Data Science Manager)
â”‚   â”‚   â””â”€â”€ (4 data scientists)
â”‚   â””â”€â”€ Noah Fischer (IT Director)
â”‚       â””â”€â”€ (5 IT staff)
â”œâ”€â”€ Richard Chen (CFO)
â”‚   â””â”€â”€ Tobias Klein (Finance Director)
â”‚       â””â”€â”€ (5 finance staff)
â”œâ”€â”€ Victoria Adams (COO)
â”‚   â”œâ”€â”€ Elena Rossi (VP Sales) â†’ 8 sales staff
â”‚   â”œâ”€â”€ Hannah Wright (Marketing Director) â†’ 4 marketing staff
â”‚   â”œâ”€â”€ Mina Patel (Head of People) â†’ 5 HR staff
â”‚   â””â”€â”€ Alexandra Stone (CS Director) â†’ 5 CS staff
â””â”€â”€ Margaret Thompson (General Counsel)
    â””â”€â”€ (2 legal staff)
```

### Locations

| Location | Employees | Primary Departments |
|----------|-----------|---------------------|
| Berlin | 39 | Engineering, Executive, IT, HR |
| Hamburg | 12 | Sales, Customer Success |
| Munich | 11 | Finance, Engineering |

### Sample Employee: Alex Kim

Use Alex Kim (employee_id: 201) as a test user to explore all features:

| Field | Value |
|-------|-------|
| Email | alex.kim@acme.com |
| Title | Software Engineer |
| Department | Engineering |
| Location | Berlin |
| Manager | Sam Nguyen |
| Skip-level | Amanda Foster (CTO) |
| Hire Date | 2022-01-10 |
| Salary | â‚¬85,000 |
| Holiday Balance | 28 days + 2 carried over |

### SQL vs Agent Comparison

**Question: "What is Alex Kim's holiday balance?"**

**Raw SQL:**
```sql
SELECT * FROM holiday_entitlement WHERE employee_id = 201 AND year = 2026;
-- Returns: employee_id: 201, year: 2026, entitlement_days: 28.0, carried_over_days: 2.0
```

**Agent Response:**
> "Alex Kim's holiday balance for 2026 is as follows: Entitled: 28.0 days, Carried over: 2.0 days, Approved taken: 0.0 days, Pending: 5.0 days, Remaining: 25.0 days."

The agent provides:
- âœ… Calculated remaining balance
- âœ… Pending requests factored in
- âœ… User-friendly formatting
- âœ… Complete context

---

## Agent Design

### Request Flow

```
                            ğŸ’¬ USER INPUT
                     â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
                     â”‚   "What's my PTO?"     â”‚
                     â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
                                 â”‚
                                 â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  STEP 1: SESSION MANAGEMENT                                          ğŸ“‹     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘   â”‚  â‘  Load existing session or create new one                          â”‚   â•‘
â•‘   â”‚  â‘¡ Check for pending confirmations (human-in-the-loop)              â”‚   â•‘
â•‘   â”‚  â‘¢ If confirmation pending: process yes/no â†’ skip to step 6         â”‚   â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                                       â”‚
                                                       â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  STEP 2: CONTEXT CONSTRUCTION                                        ğŸ—ï¸     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®    â•‘
â•‘   â”‚  ğŸ‘¤ Requester      â”‚  â”‚  ğŸ’¬ Conversation   â”‚  â”‚  ğŸ“Š Session        â”‚    â•‘
â•‘   â”‚     Context        â”‚  â”‚     History        â”‚  â”‚     State          â”‚    â•‘
â•‘   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â•‘
â•‘   â”‚ employee_id: 201   â”‚  â”‚ Last 10 turns:     â”‚  â”‚ last_search: true  â”‚    â•‘
â•‘   â”‚ role: EMPLOYEE     â”‚  â”‚ â€¢ User messages    â”‚  â”‚ target_employee:   â”‚    â•‘
â•‘   â”‚ email: alex@...    â”‚  â”‚ â€¢ Assistant msgs   â”‚  â”‚   {...}            â”‚    â•‘
â•‘   â”‚ name: Alex Kim     â”‚  â”‚ â€¢ Tool results     â”‚  â”‚ pending_action:    â”‚    â•‘
â•‘   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯  â”‚   null             â”‚    â•‘
â•‘                                                   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                                       â”‚
                                                       â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  STEP 3: LLM INVOCATION                                              ğŸ¤–     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®    â•‘
â•‘   â”‚                    âš¡ LLM REQUEST                                   â”‚    â•‘
â•‘   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â•‘
â•‘   â”‚  â”‚     SYSTEM PROMPT        â”‚    â”‚      USER MESSAGE            â”‚ â”‚    â•‘
â•‘   â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚ â”‚    â•‘
â•‘   â”‚  â”‚  â€¢ Role: HR Assistant    â”‚    â”‚  Query: "What's my PTO?"     â”‚ â”‚    â•‘
â•‘   â”‚  â”‚  â€¢ Available tools (25)  â”‚ +  â”‚  Context: employee_id=201    â”‚ â”‚    â•‘
â•‘   â”‚  â”‚  â€¢ Response format (JSON)â”‚    â”‚  History: [prior turns...]   â”‚ â”‚    â•‘
â•‘   â”‚  â”‚  â€¢ Guidelines & rules    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â•‘
â•‘   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚    â•‘
â•‘   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯    â•‘
â•‘                                    â”‚                                         â•‘
â•‘                                    â–¼                                         â•‘
â•‘   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®    â•‘
â•‘   â”‚                    ğŸ“¤ LLM RESPONSE (JSON)                          â”‚    â•‘
â•‘   â”‚  {                                                                 â”‚    â•‘
â•‘   â”‚    "action": "get_holiday_balance",                                â”‚    â•‘
â•‘   â”‚    "target_employee_id": 201,                                      â”‚    â•‘
â•‘   â”‚    "year": 2026                                                    â”‚    â•‘
â•‘   â”‚  }                                                                 â”‚    â•‘
â•‘   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                                       â”‚
                                                       â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  STEP 4: ACTION PARSING & VALIDATION                                 âœ…     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®       â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®       â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®      â•‘
â•‘   â”‚  JSON Response â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚  AgentAction   â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚  Parameter     â”‚      â•‘
â•‘   â”‚  (raw text)    â”‚ Parse â”‚  Model         â”‚Verify â”‚  Validation    â”‚      â•‘
â•‘   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯       â”‚  â€¢ action: str â”‚       â”‚  â€¢ types       â”‚      â•‘
â•‘                            â”‚  â€¢ target_id   â”‚       â”‚  â€¢ ranges      â”‚      â•‘
â•‘                            â”‚  â€¢ year: int   â”‚       â”‚  â€¢ required    â”‚      â•‘
â•‘                            â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯       â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                                       â”‚
                                                       â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  STEP 5: POLICY EVALUATION                                           ğŸ”     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®    â•‘
â•‘   â”‚                     POLICY ENGINE                                  â”‚    â•‘
â•‘   â”‚                                                                    â”‚    â•‘
â•‘   â”‚   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®  â”‚    â•‘
â•‘   â”‚   â”‚ ğŸ“ Load YAML   â”‚â”€â”€â”€â–ºâ”‚ ğŸ” Evaluate    â”‚â”€â”€â”€â–ºâ”‚ âš–ï¸  Decision    â”‚  â”‚    â•‘
â•‘   â”‚   â”‚    Rules       â”‚    â”‚    Context     â”‚    â”‚                â”‚  â”‚    â•‘
â•‘   â”‚   â”‚ (policies.yaml)â”‚    â”‚ â€¢ is_self? âœ“   â”‚    â”‚   âœ… ALLOW     â”‚  â”‚    â•‘
â•‘   â”‚   â”‚                â”‚    â”‚ â€¢ is_manager?  â”‚    â”‚   No confirm   â”‚  â”‚    â•‘
â•‘   â”‚   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯  â”‚    â•‘
â•‘   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯    â•‘
â•‘                                                                              â•‘
â•‘   Decision outcomes:                                                         â•‘
â•‘   â€¢ ALLOW â†’ Continue to Step 6                                               â•‘
â•‘   â€¢ DENY â†’ Return "Access Denied" message                                    â•‘
â•‘   â€¢ ALLOW + requires_confirmation â†’ Store pending, return confirmation       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                                       â”‚
                                                       â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  STEP 6: TOOL EXECUTION                                              âš¡     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®    â•‘
â•‘   â”‚                       TOOL EXECUTOR                                â”‚    â•‘
â•‘   â”‚                                                                    â”‚    â•‘
â•‘   â”‚   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®  â”‚    â•‘
â•‘   â”‚   â”‚ ğŸ—ºï¸  Map Action  â”‚â”€â”€â”€â–ºâ”‚ ğŸ“ Call        â”‚â”€â”€â”€â–ºâ”‚ ğŸ“ Format      â”‚  â”‚    â•‘
â•‘   â”‚   â”‚    to Handler  â”‚    â”‚    Service     â”‚    â”‚    Response    â”‚  â”‚    â•‘
â•‘   â”‚   â”‚                â”‚    â”‚    Layer       â”‚    â”‚                â”‚  â”‚    â•‘
â•‘   â”‚   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯  â”‚    â•‘
â•‘   â”‚                                                                    â”‚    â•‘
â•‘   â”‚   get_holiday_balance â”€â”€â–º HolidayService.get_balance() â”€â”€â–º JSON   â”‚    â•‘
â•‘   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                                       â”‚
                                                       â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  STEP 7: MULTI-TURN LOOP                                             ğŸ”„     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘             â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                           â•‘
â•‘             â”‚    Is action "final_answer"?       â”‚                           â•‘
â•‘             â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯                           â•‘
â•‘                            â”‚                                                 â•‘
â•‘           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â•‘
â•‘           â”‚                                 â”‚                                â•‘
â•‘           â–¼ NO                              â–¼ YES                            â•‘
â•‘   â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®        â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®    â•‘
â•‘   â”‚  Feed tool result     â”‚        â”‚          ğŸ¯ FINAL RESPONSE        â”‚    â•‘
â•‘   â”‚  back to LLM for      â”‚        â”‚  "Your PTO balance for 2026:      â”‚    â•‘
â•‘   â”‚  next action          â”‚        â”‚   20 days remaining out of 25     â”‚    â•‘
â•‘   â”‚                       â”‚        â”‚   days total. You have used 5     â”‚    â•‘
â•‘   â”‚  (Loop back to Step 3)â”‚        â”‚   days so far."                   â”‚    â•‘
â•‘   â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯        â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯    â•‘
â•‘               â”‚                                                              â•‘
â•‘               â”‚                              â–²                               â•‘
â•‘               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â•‘
â•‘                      (max 5 iterations)                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Conversation Memory

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      ğŸ’¾ ConversationSession                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   session_id   â”‚  "abc-123-def"                                              â•‘
â•‘   user_email   â”‚  "alex.kim@acme.com"                                        â•‘
â•‘   created_at   â”‚  2026-01-25T10:30:00Z                                       â•‘
â•‘                                                                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘   ğŸ“œ TURNS (Sliding Window - Last 10)                                        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘   â”‚ Turn 1  â”‚ ğŸ‘¤ user      â”‚ "Who is my manager?"                       â”‚   â•‘
â•‘   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â•‘
â•‘   â”‚ Turn 2  â”‚ ğŸ¤– assistant â”‚ {"action": "get_manager", ...}             â”‚   â•‘
â•‘   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â•‘
â•‘   â”‚ Turn 3  â”‚ ğŸ”§ tool      â”‚ {"result": "Sam Nguyen", "id": 200}        â”‚   â•‘
â•‘   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â•‘
â•‘   â”‚ Turn 4  â”‚ ğŸ¤– assistant â”‚ {"action": "final_answer", "answer": ...}  â”‚   â•‘
â•‘   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â•‘
â•‘   â”‚ Turn 5  â”‚ ğŸ‘¤ user      â”‚ "What about their direct reports?"        â”‚   â•‘
â•‘   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â•‘
â•‘   â”‚ Turn 6  â”‚ ğŸ¤– assistant â”‚ {"action": "get_direct_reports", ...}      â”‚   â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                                                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘   ğŸ“Š CONTEXT (Persistent State)                                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   {                                                                          â•‘
â•‘     "last_search": true,                    â† Enables "that person" refs     â•‘
â•‘     "target_employee": {                                                     â•‘
â•‘       "id": 200,                            â† Last referenced employee       â•‘
â•‘       "name": "Sam Nguyen",                                                  â•‘
â•‘       "department": "Engineering"                                            â•‘
â•‘     },                                                                       â•‘
â•‘     "last_tool_used": "get_manager"         â† For contextual follow-ups     â•‘
â•‘   }                                                                          â•‘
â•‘                                                                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘   â³ PENDING CONFIRMATION (Human-in-the-Loop)                                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   {                                                                          â•‘
â•‘     "action": "submit_holiday_request",     â† Stored action awaiting OK     â•‘
â•‘     "params": {                                                              â•‘
â•‘       "start_date": "2026-02-01",                                            â•‘
â•‘       "end_date": "2026-02-05",                                              â•‘
â•‘       "days": 5,                                                             â•‘
â•‘       "reason": "Vacation"                                                   â•‘
â•‘     },                                                                       â•‘
â•‘     "message": "Submit 5 days PTO starting Feb 1? (yes/no)"                  â•‘
â•‘   }                                                                          â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Memory Features:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ“ Sliding window of recent turns (configurable, default 10)                â”‚
â”‚  âœ“ Persistent context for multi-step workflows                              â”‚
â”‚  âœ“ Pending confirmation state for sensitive actions                          â”‚
â”‚  âœ“ Automatic context cleanup on session end                                  â”‚
â”‚  âœ“ Thread-safe for concurrent requests                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Human-in-the-Loop Confirmation Flow

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   ğŸ›¡ï¸ HUMAN-IN-THE-LOOP CONFIRMATION                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‘¤ User: "Submit a holiday request for next week, 5 days"
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ” ACTION DETECTION                                                        â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚   Agent detects sensitive action: submit_holiday_request                     â”‚
â”‚   Action is in ACTIONS_REQUIRING_CONFIRMATION list                           â”‚
â”‚                                                                              â”‚
â”‚   âš ï¸  This action modifies data and requires explicit user consent           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ’¾ STORE PENDING CONFIRMATION                                              â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚   Session state updated:                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚  pending_confirmation: {                                               â”‚â”‚
â”‚   â”‚    "action": "submit_holiday_request",                                 â”‚â”‚
â”‚   â”‚    "params": {                                                         â”‚â”‚
â”‚   â”‚      "start_date": "2026-02-01",                                       â”‚â”‚
â”‚   â”‚      "end_date": "2026-02-05",                                         â”‚â”‚
â”‚   â”‚      "days": 5,                                                        â”‚â”‚
â”‚   â”‚      "reason": "Vacation"                                              â”‚â”‚
â”‚   â”‚    }                                                                   â”‚â”‚
â”‚   â”‚  }                                                                     â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ’¬ CONFIRMATION PROMPT                                                     â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                              â”‚
â”‚   ğŸ¤– Agent Response:                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚  "You're about to submit a holiday request for 5 days from            â”‚â”‚
â”‚   â”‚   2026-02-01 to 2026-02-05.                                           â”‚â”‚
â”‚   â”‚                                                                        â”‚â”‚
â”‚   â”‚   Please confirm by typing 'yes' or cancel with 'no'."                â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚
                    â–¼                               â–¼
        â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®           â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
        â”‚  ğŸ‘¤ User: "yes"   â”‚           â”‚  ğŸ‘¤ User: "no"    â”‚
        â”‚                   â”‚           â”‚     or other      â”‚
        â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯           â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
                  â”‚                               â”‚
                  â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   âœ… EXECUTE ACTION             â”‚ â”‚   âŒ CANCEL ACTION               â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚ â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                 â”‚ â”‚                                 â”‚
â”‚   â€¢ Load stored parameters      â”‚ â”‚   â€¢ Clear pending_confirmation  â”‚
â”‚   â€¢ Call submit_holiday_request â”‚ â”‚   â€¢ Log cancellation            â”‚
â”‚   â€¢ Clear pending_confirmation  â”‚ â”‚                                 â”‚
â”‚   â€¢ Record in audit log         â”‚ â”‚                                 â”‚
â”‚                                 â”‚ â”‚                                 â”‚
â”‚   ğŸ¤– Response:                  â”‚ â”‚   ğŸ¤– Response:                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ "Holiday request        â”‚   â”‚ â”‚   â”‚ "Action cancelled.      â”‚   â”‚
â”‚   â”‚  submitted successfully!â”‚   â”‚ â”‚   â”‚  Your holiday request   â”‚   â”‚
â”‚   â”‚  Request #1234 pending  â”‚   â”‚ â”‚   â”‚  was not submitted."    â”‚   â”‚
â”‚   â”‚  manager approval."     â”‚   â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   ğŸ“‹ ACTIONS REQUIRING CONFIRMATION                                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘   Action                      â”‚  Confirmation Message Template               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘   submit_holiday_request      â”‚  "Submit {days} days PTO from {start}..."    â•‘
â•‘   cancel_holiday_request      â”‚  "Cancel holiday request #{request_id}..."   â•‘
â•‘   approve_holiday_request     â”‚  "Approve {employee}'s request #{id}..."     â•‘
â•‘   reject_holiday_request      â”‚  "Reject {employee}'s request #{id}..."      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•§â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Policy Engine

Authorization is handled by a declarative policy engine inspired by Open Policy Agent (OPA).

### Policy Evaluation Flow

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        ğŸ” POLICY EVALUATION ENGINE                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
                    â”‚         ğŸ“‹ Policy Context             â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚  requester_id: 201              â”‚  â”‚
                    â”‚  â”‚  requester_role: EMPLOYEE       â”‚  â”‚
                    â”‚  â”‚  action: get_compensation       â”‚  â”‚
                    â”‚  â”‚  target_id: 201                 â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
                                         â”‚
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ“ LOAD RULES FROM policies.yaml                                           â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚   Rules sorted by priority (highest first â†’ evaluated first)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   RULE 1 (priority: 30)  â”‚  "hr_view_any_compensation"                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â•‘
â•‘   â”‚  ğŸ“œ Rule Definition:                                                   â”‚â•‘
â•‘   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â•‘
â•‘   â”‚  â”‚  condition: is_hr                                                â”‚ â”‚â•‘
â•‘   â”‚  â”‚  effect: allow                                                   â”‚ â”‚â•‘
â•‘   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â•‘
â•‘   â”‚                                                                        â”‚â•‘
â•‘   â”‚  ğŸ” Evaluate: requester_role == "HR" ?                                â”‚â•‘
â•‘   â”‚               EMPLOYEE == "HR" ?  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  âŒ NO          â”‚â•‘
â•‘   â”‚                                                                        â”‚â•‘
â•‘   â”‚  ğŸ“Š Result: Skip to next rule                                         â”‚â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                         â”‚
                                         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   RULE 2 (priority: 10)  â”‚  "view_own_compensation"                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â•‘
â•‘   â”‚  ğŸ“œ Rule Definition:                                                   â”‚â•‘
â•‘   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â•‘
â•‘   â”‚  â”‚  condition: is_self                                              â”‚ â”‚â•‘
â•‘   â”‚  â”‚  effect: allow                                                   â”‚ â”‚â•‘
â•‘   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â•‘
â•‘   â”‚                                                                        â”‚â•‘
â•‘   â”‚  ğŸ” Evaluate: requester_id == target_id ?                             â”‚â•‘
â•‘   â”‚               201 == 201 ?  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  âœ… YES        â”‚â•‘
â•‘   â”‚                                                                        â”‚â•‘
â•‘   â”‚  ğŸ“Š Result: MATCH FOUND â”€â”€â–º Return ALLOW                              â”‚â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                         â”‚
                                         â–¼
                              â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
                              â”‚  âš–ï¸ FINAL DECISION â”‚
                              â”‚                   â”‚
                              â”‚     âœ… ALLOW      â”‚
                              â”‚                   â”‚
                              â”‚  Action proceeds  â”‚
                              â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   ğŸ“ POLICY RULE STRUCTURE                                                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â•‘
â•‘   â”‚  - name: "view_own_compensation"                                       â”‚â•‘
â•‘   â”‚    description: "Employees can view their own compensation"            â”‚â•‘
â•‘   â”‚    effect: "allow"              # allow | deny                         â”‚â•‘
â•‘   â”‚    priority: 10                 # Higher = evaluated first             â”‚â•‘
â•‘   â”‚    condition: "is_self"         # Expression to evaluate               â”‚â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   ğŸ§° AVAILABLE CONDITION HELPERS                                             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘   Helper                     â”‚  Description                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘   is_self                    â”‚  requester_id == target_id                    â•‘
â•‘   is_manager                 â”‚  requester has MANAGER role                   â•‘
â•‘   is_hr                      â”‚  requester has HR role                        â•‘
â•‘   is_direct_report           â”‚  target is direct report of requester         â•‘
â•‘   finance_has_cost_center    â”‚  finance user has access to cost center       â•‘
â•‘   _access                    â”‚                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•§â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Available Tools

The agent has access to 25 tools organized into 5 categories:

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         ğŸ› ï¸  TOOL CATEGORIES                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                     â•‘
â•‘  â”‚  ğŸ‘¤ EMPLOYEE INFO (3)  â”‚  â”‚  ğŸ¢ ORGANIZATION (6)   â”‚                     â•‘
â•‘  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚                        â”‚                     â•‘
â•‘  â”‚  â€¢ search_employee     â”‚  â”‚  â€¢ get_manager         â”‚                     â•‘
â•‘  â”‚    Search by name/emailâ”‚  â”‚    Direct manager      â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚                        â”‚                     â•‘
â•‘  â”‚  â€¢ get_employee_basic  â”‚  â”‚  â€¢ get_direct_reports  â”‚                     â•‘
â•‘  â”‚    Profile details     â”‚  â”‚    Team members        â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚                        â”‚                     â•‘
â•‘  â”‚  â€¢ get_employee_tenure â”‚  â”‚  â€¢ get_manager_chain   â”‚                     â•‘
â•‘  â”‚    Hire date & tenure  â”‚  â”‚    Full chain to CEO   â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚                        â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚  â€¢ get_team_overview   â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚    Team summary        â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚                        â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚  â€¢ get_department_     â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚    directory           â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚    Department roster   â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚                        â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚  â€¢ get_org_chart       â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚    Org structure       â”‚                     â•‘
â•‘  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯                     â•‘
â•‘                                                                              â•‘
â•‘  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                     â•‘
â•‘  â”‚  ğŸ–ï¸ TIME OFF (8)       â”‚  â”‚  ğŸ’° COMPENSATION (3)   â”‚                     â•‘
â•‘  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚                        â”‚                     â•‘
â•‘  â”‚  â€¢ get_holiday_balance â”‚  â”‚  â€¢ get_compensation    â”‚                     â•‘
â•‘  â”‚    PTO balance         â”‚  â”‚    Salary details      â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚                        â”‚                     â•‘
â•‘  â”‚  â€¢ get_holiday_        â”‚  â”‚  â€¢ get_salary_history  â”‚                     â•‘
â•‘  â”‚    requests            â”‚  â”‚    Salary changes      â”‚                     â•‘
â•‘  â”‚    Request history     â”‚  â”‚                        â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚  â€¢ get_team_           â”‚                     â•‘
â•‘  â”‚  â€¢ submit_holiday_  âš ï¸ â”‚  â”‚    compensation_       â”‚                     â•‘
â•‘  â”‚    request             â”‚  â”‚    summary             â”‚                     â•‘
â•‘  â”‚    Submit new request  â”‚  â”‚    HR: team salaries   â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚                        â”‚                     â•‘
â•‘  â”‚  â€¢ cancel_holiday_  âš ï¸ â”‚  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯                     â•‘
â•‘  â”‚    request             â”‚                                                 â•‘
â•‘  â”‚    Cancel pending      â”‚  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                     â•‘
â•‘  â”‚                        â”‚  â”‚  ğŸ¢ COMPANY INFO (5)   â”‚                     â•‘
â•‘  â”‚  â€¢ get_pending_        â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚                     â•‘
â•‘  â”‚    approvals           â”‚  â”‚                        â”‚                     â•‘
â•‘  â”‚    Manager: pending    â”‚  â”‚  â€¢ get_company_        â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚    policies            â”‚                     â•‘
â•‘  â”‚  â€¢ approve_holiday_ âš ï¸ â”‚  â”‚    List all policies   â”‚                     â•‘
â•‘  â”‚    request             â”‚  â”‚                        â”‚                     â•‘
â•‘  â”‚    Manager: approve    â”‚  â”‚  â€¢ get_policy_details  â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚    Full policy text    â”‚                     â•‘
â•‘  â”‚  â€¢ reject_holiday_  âš ï¸ â”‚  â”‚                        â”‚                     â•‘
â•‘  â”‚    request             â”‚  â”‚  â€¢ get_company_        â”‚                     â•‘
â•‘  â”‚    Manager: reject     â”‚  â”‚    holidays            â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚    Holiday calendar    â”‚                     â•‘
â•‘  â”‚  â€¢ get_team_calendar   â”‚  â”‚                        â”‚                     â•‘
â•‘  â”‚    Manager: schedule   â”‚  â”‚  â€¢ get_announcements   â”‚                     â•‘
â•‘  â”‚                        â”‚  â”‚    Recent news         â”‚                     â•‘
â•‘  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯  â”‚                        â”‚                     â•‘
â•‘                              â”‚  â€¢ get_upcoming_events â”‚                     â•‘
â•‘                              â”‚    Upcoming events     â”‚                     â•‘
â•‘                              â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯                     â•‘
â•‘                                                                              â•‘
â•‘  âš ï¸  = Requires human-in-the-loop confirmation before execution              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Tool Reference

#### Employee Information

| Tool | Description | Parameters |
|------|-------------|------------|
| `search_employee` | Search by name, email, or title | `query`, `limit` |
| `get_employee_basic` | Get employee profile | `employee_id` |
| `get_employee_tenure` | Get hire date and tenure | `employee_id` |

#### Organization

| Tool | Description | Parameters |
|------|-------------|------------|
| `get_manager` | Get direct manager | `employee_id` |
| `get_direct_reports` | List direct reports | `employee_id` |
| `get_manager_chain` | Full chain to CEO | `employee_id` |
| `get_team_overview` | Team summary | `employee_id` |
| `get_department_directory` | Department roster | `department` |
| `get_org_chart` | Org structure | `employee_id`, `max_depth` |

#### Time Off

| Tool | Description | Parameters |
|------|-------------|------------|
| `get_holiday_balance` | PTO balance | `employee_id`, `year` |
| `get_holiday_requests` | Request history | `employee_id`, `year` |
| `submit_holiday_request` | Submit request (confirmation required) | `start_date`, `end_date`, `days`, `reason` |
| `cancel_holiday_request` | Cancel request (confirmation required) | `request_id` |
| `get_pending_approvals` | Manager: pending requests | - |
| `approve_holiday_request` | Manager: approve (confirmation required) | `request_id` |
| `reject_holiday_request` | Manager: reject (confirmation required) | `request_id`, `reason` |
| `get_team_calendar` | Manager: team schedule | `year`, `month` |

#### Compensation

| Tool | Description | Parameters |
|------|-------------|------------|
| `get_compensation` | Salary details | `employee_id` |
| `get_salary_history` | Salary changes | `employee_id` |
| `get_team_compensation_summary` | HR: team salaries | `manager_employee_id` |

#### Company Information

| Tool | Description | Parameters |
|------|-------------|------------|
| `get_company_policies` | List all policies | - |
| `get_policy_details` | Full policy text | `policy_id` |
| `get_company_holidays` | Holiday calendar | `year` |
| `get_announcements` | Recent news | `limit` |
| `get_upcoming_events` | Upcoming events | - |

---

## Access Control

### Roles

| Role | Description |
|------|-------------|
| EMPLOYEE | Standard employee with access to own data |
| MANAGER | Employee with direct reports; can view team data |
| HR | Full access to employee data |
| FINANCE | Access to cost-center-scoped data |

### Access Matrix

| Resource | EMPLOYEE | MANAGER | HR | FINANCE |
|----------|----------|---------|-----|---------|
| Own profile | Yes | Yes | Yes | Yes |
| Other profiles (basic) | Yes | Yes | Yes | Yes |
| Own compensation | Yes | Yes | Yes | No |
| Report compensation | No | No | Yes | No |
| Own holiday balance | Yes | Yes | Yes | Yes |
| Report holiday balance | No | Yes | Yes | No |
| Submit own request | Yes | Yes | Yes | Yes |
| Approve/reject requests | No | Direct reports only | Yes | No |
| Company policies | Yes | Yes | Yes | Yes |

---

## Getting Started

### Prerequisites

- Python 3.10+
- An LLM API (OpenAI, Databricks, or compatible)

### Installation

```bash
# Clone and enter directory
cd hr-agent

# Create virtual environment
python -m venv .venv
source .venv/bin/activate  # On Windows: .venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt
```

### Configuration

Create a `.env` file:

```bash
# User simulation
DEMO_USER_EMAIL=alex.kim@acme.com

# Database
DB_URL=sqlite:///./hr_demo.db

# LLM Configuration (OpenAI)
LLM_API_KEY=sk-your-openai-key
LLM_BASE_URL=https://api.openai.com/v1
LLM_MODEL=gpt-4o-mini

# LLM Configuration (Databricks)
# LLM_API_KEY=dapi-your-databricks-token
# LLM_BASE_URL=https://<workspace>.cloud.databricks.com/serving-endpoints
# LLM_MODEL=databricks-meta-llama-3-1-70b-instruct
```

### Running the Web UI (Recommended)

The easiest way to test the agent is through the Streamlit web interface:

```bash
# Start the web UI
streamlit run app.py

# Opens automatically at http://localhost:8501
```

### Running the CLI

```bash
# Single query
PYTHONPATH=src python -m hr_agent.api.cli "What is my holiday balance?"

# Interactive mode
PYTHONPATH=src python -m hr_agent.api.cli -i

# With custom user
PYTHONPATH=src python -m hr_agent.api.cli -u sarah.chen@acme.com "Who are my direct reports?"
```

### Running the API Server

```bash
PYTHONPATH=src python -m hr_agent.api.server
```

The API will be available at `http://localhost:8000` with interactive docs at `/docs`.

---

## API Reference

### Endpoints

| Method | Path | Description |
|--------|------|-------------|
| POST | `/chat` | Send a message to the agent |
| GET | `/session/{session_id}` | Get session info |
| DELETE | `/session/{session_id}` | Delete a session |
| GET | `/me` | Get current user context |
| GET | `/health` | Health check |

### Chat Request

```bash
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -H "X-User-Email: alex.kim@acme.com" \
  -d '{"message": "What is my holiday balance?"}'
```

### Response Format

```json
{
  "response": "Your holiday balance for 2026: ...",
  "session_id": "abc123",
  "timestamp": "2026-01-25T10:30:00Z"
}
```

---

## Evaluation Framework

The project includes an evaluation harness for testing agent behavior.

### Running Evaluations

```bash
# Full evaluation suite
PYTHONPATH=src python run_evals.py

# Quick smoke test
PYTHONPATH=src python run_evals.py --quick

# Verbose output
PYTHONPATH=src python run_evals.py --verbose
```

### Evaluation Metrics

| Metric | Description |
|--------|-------------|
| Pass Rate | Percentage of cases that pass all criteria |
| Tool Accuracy | Correct tool selection rate |
| Answer Quality | Response contains expected content |
| Latency | Response time percentiles |

### Adding Test Cases

Test cases are defined in `evals/datasets.py`:

```python
EvalCase(
    id="holiday_balance_self",
    category=EvalCategory.TIME_OFF,
    difficulty=EvalDifficulty.EASY,
    user_email="alex.kim@acme.com",
    query="What is my holiday balance?",
    expected_tools=["get_holiday_balance"],
    expected_to_contain=["remaining", "days"],
)
```

---

## Project Structure

```
hr-agent/
â”‚
â”œâ”€â”€ ğŸ“„ README.md                    # This documentation
â”œâ”€â”€ ğŸ“„ ARCHITECTURE.md              # Detailed architecture notes
â”œâ”€â”€ ğŸ“„ requirements.txt             # Python dependencies
â”œâ”€â”€ ğŸ“„ .env.example                 # Environment template
â”œâ”€â”€ ğŸ—„ï¸ hr_demo.db                   # SQLite database (generated)
â”œâ”€â”€ ğŸ–¥ï¸ app.py                       # Streamlit Web UI
â”‚
â”œâ”€â”€ ğŸ“ src/hr_agent/                # Main application source
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py              # Package initialization
â”‚   â”œâ”€â”€ ğŸ“„ seed.py                  # Database seeding (62 employees)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ core/                    # ğŸ§  Agent Orchestration
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ agent.py             #   Main HRAgent class
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ llm.py               #   LLM client wrapper
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ memory.py            #   Conversation memory
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ policy_engine.py     #   Authorization engine
â”‚   â”‚   â””â”€â”€ ğŸ“„ response_utils.py    #   Response formatting
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ domain/                  # ğŸ“Š Domain Models
â”‚   â”‚   â””â”€â”€ ğŸ“„ models.py            #   Pydantic models, enums
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ services/                # âš™ï¸ Business Logic
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ base.py              #   Service base classes
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ tools.py             #   Tool implementations
â”‚   â”‚   â””â”€â”€ ğŸ“„ tool_registry.py     #   Tool definitions
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ repositories/            # ğŸ“¦ Data Access
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ base.py              #   Repository base class
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ employee.py          #   Employee data access
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ holiday.py           #   Holiday data access
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ compensation.py      #   Compensation data access
â”‚   â”‚   â””â”€â”€ ğŸ“„ company.py           #   Company data access
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ api/                     # ğŸŒ External Interfaces
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ server.py            #   FastAPI application
â”‚   â”‚   â””â”€â”€ ğŸ“„ cli.py               #   Command-line interface
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ infrastructure/          # ğŸ”§ Cross-cutting Concerns
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ config.py            #   Settings management
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ db.py                #   Database connection
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ errors.py            #   Custom exceptions
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ observability.py     #   Logging, metrics
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ security.py          #   Rate limiting, audit
â”‚   â”‚   â””â”€â”€ ğŸ“„ validation.py        #   Input validation
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ policies/                # ğŸ” Policy Configuration
â”‚       â””â”€â”€ ğŸ“„ policies.yaml        #   Authorization rules
â”‚
â”œâ”€â”€ ğŸ“ evals/                       # ğŸ§ª Evaluation Framework
â”‚   â”œâ”€â”€ ğŸ“„ datasets.py              #   Test case definitions
â”‚   â”œâ”€â”€ ğŸ“„ runner.py                #   Test runner
â”‚   â”œâ”€â”€ ğŸ“„ metrics.py               #   Metrics collection
â”‚   â”œâ”€â”€ ğŸ“„ analysis.py              #   Results analysis
â”‚   â””â”€â”€ ğŸ“„ logger.py                #   Eval logging
â”‚
â”œâ”€â”€ ğŸ“ eval_results/                # ğŸ“ˆ Evaluation Results (generated)
â”‚   â””â”€â”€ ğŸ“„ eval_*.json              #   Test run results
â”‚
â”œâ”€â”€ ğŸ“„ run_evals.py                 # Evaluation entry point
â””â”€â”€ ğŸ“„ test_tools.py                # Unit tests
```

---

## Configuration

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `DEMO_USER_EMAIL` | Simulated logged-in user | `alex.kim@acme.com` |
| `DB_URL` | Database connection string | `sqlite:///./hr_demo.db` |
| `LLM_API_KEY` | API key for LLM provider | - |
| `LLM_BASE_URL` | LLM API base URL | - |
| `LLM_MODEL` | Model identifier | `gpt-4o-mini` |
| `API_HOST` | API server host | `0.0.0.0` |
| `API_PORT` | API server port | `8000` |

### Supported LLM Providers

Any OpenAI-compatible API:
- OpenAI (GPT-4, GPT-4o, GPT-4o-mini)
- Databricks Foundation Models
- Azure OpenAI
- Anthropic (via compatibility layer)
- Local models (Ollama, vLLM)

---

## Development

### Running Tests

```bash
# Unit tests
python test_tools.py

# Linting
pylint src/ evals/
flake8 src/ evals/
ruff check src/ evals/
```

### Reseeding the Database

To reset the database with fresh demo data:

```bash
# Delete existing database and reseed
rm hr_demo.db
PYTHONPATH=src python -c "from hr_agent.seed import seed_database; seed_database()"
```

### Code Quality

The project maintains:
- Pylint score: 10.00/10
- Type hints throughout
- Comprehensive docstrings
- Consistent code formatting

---

## License

MIT License - See LICENSE file for details.
